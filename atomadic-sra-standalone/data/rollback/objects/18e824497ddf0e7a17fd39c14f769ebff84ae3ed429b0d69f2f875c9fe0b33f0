
from src.agents.luminary_base import LuminaryBase
from src.core.ollama_service import OllamaService
from src.core.evolution_vault import EvolutionVault
import json

class NoveltyEngine(LuminaryBase):
    """
    Novelty Engine
    Mines serendipitous ideas and logs them to the vault.
    """
    def __init__(self, name="NoveltyEngine"):
        super().__init__(name)
        self.llm = OllamaService()
        self.vault = EvolutionVault()

    def generate_novelty(self, seed_trace="System Logic"):
        """
        Generates a Novelty Proposal.
        """
        prompt = (
            f"Generate a 'Novelty Proposal' based on the seed trace: {seed_trace}. "
            "Focus on stable, interesting, and theoretically sound ideas. "
            "Format as JSON with keys: title, idea_summary, novelty_rationale, impact_assessment. "
            "Ensure the output is valid JSON."
        )

        print(f"[{self.name}] Scanning for novelty...")
        response = self.llm.generate_completion(prompt)

        if response:
            try:
                # Basic cleanup
                response = response.replace("```json", "").replace("```", "").strip()
                item = json.loads(response)

                # Log to vault
                self.vault.log_item("novelties", item)
                return item
            except json.JSONDecodeError:
                print(f"[{self.name}] Failed to parse JSON response.")
        return None
